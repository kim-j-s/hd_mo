{{#> layout/default page-title="해외여행보험 | 상품"}}

<!-- s: Bottom 팝업 -->
{{#> popup/popup_bottom popup-id="pop_type01" popup-title="여행기간 선택" popup-active=true }}
<div class="popup_cont">
	<div class="popup_content">
		{{> cp/calendar}}
		<div class="date_select_area">
			<div class="radio_group_wrap_ty2" role="radiogroup">
				{{> cp/radio rd-class="rd_btn" rd-id="time_t1" name="time_t" labelname="오전" }}
				{{> cp/radio rd-class="rd_btn" rd-id="time_t2" name="time_t" labelname="오후" }}
			</div>
			<div class="dsa_bottom">
				<div class="dsa_date">2025.03.12~2025.03.21(9박 10일)</div>
				<div class="form_group_wrap">
					<div class="row">
						<div class="form_line grow">
							<div class="label_tit">출발시간</div>
							{{> cp/selectitem si_ph="시간 선택" si_title="출발시간 팝업 오픈" si_popup="pop1"}}
						</div>
						<div class="form_line grow">
							<div class="label_tit">도착시간</div>
							{{> cp/selectitem si_ph="시간 선택" si_title="도착시간 팝업 오픈" si_popup="pop2"}}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="popup_bottom">
  <div class="btn_area">
    {{> cp/button type="1" size="2" b-text="도착일시를 선택 중이예요" disabled=true }}
  </div>
</div>
{{/ popup/popup_bottom}}
<!-- e: Bottom 팝업 -->




<script>

$(document).ready(function() {
  let startDayIndex = null;  // 현재 선택된 start_day 인덱스
  let endDayIndex = null;    // 현재 선택된 end_day 인덱스

  $('.calendar_range_item').each(function(itemIndex) {
    var calendarRangeItem = $(this);

    // 날짜 클릭 이벤트
    calendarRangeItem.find('tbody button.day_default:not([disabled])').on('click', function() {
      var clickedTd = $(this).closest('td');
      var clickedTr = clickedTd.closest('tr');
      var clickedTdIndex = clickedTd.index();
      var clickedTrIndex = clickedTr.index();
      var clickedItemIndex = itemIndex; // calendar_range_item의 인덱스
      var finalIndex = (clickedItemIndex + 1) * 100 + (clickedTrIndex + 1) * 10 + (clickedTdIndex + 1); // 최종 인덱스 계산

      // 최초 클릭이 아니면 start_day와 end_day 상태 처리
      if (startDayIndex === null) {
        // 첫 번째 클릭: start_day 부여
        $(this).addClass('day_active start_day');
        startDayIndex = finalIndex; // 첫 번째 클릭된 인덱스를 start_day로 설정
      } else {
        if ($(this).hasClass('start_day')) {
          // 이미 start_day가 부여된 버튼 클릭시 아무 동작 하지 않음
          return;
        }

        if (endDayIndex === null) {
          if (finalIndex > startDayIndex) {
            // end_day 부여
            $(this).addClass('day_active end_day');

            $('.start_day').addClass('start_day_fix');
            $('.end_day').addClass('end_day_fix');


            endDayIndex = finalIndex; // end_day 인덱스 설정

            // start_day와 end_day가 모두 설정된 후, 해당 범위의 버튼에 'between' 클래스를 부여
            markInProgressRange(startDayIndex, endDayIndex);
          } else if (finalIndex < startDayIndex) {
            // start_day가 더 큰 값이어야 하므로 start_day 변경
            $('.start_day').removeClass('day_active start_day');
            $(this).addClass('day_active start_day');
            startDayIndex = finalIndex; // 새로운 start_day 설정
            endDayIndex = null; // 이전의 end_day를 초기화
            $('.between').removeClass('between'); // 이전의 'between' 클래스 초기화
          }
        } else {
          // start_day와 end_day가 모두 설정된 후에는 새로 클릭된 날짜가 start_day로 설정됨
          // 기존의 start_day, end_day 상태 초기화
          $('.start_day').removeClass('day_active start_day');
          $('.end_day').removeClass('day_active end_day');
          $('.between').removeClass('between'); // 'between' 클래스 초기화
          $('.start_day_fix').removeClass('start_day_fix');
          $('.end_day_fix').removeClass('end_day_fix');
          

          // 새로 클릭된 날짜를 start_day로 설정
          $(this).addClass('day_active start_day');
          startDayIndex = finalIndex; // 새로운 start_day 설정
          endDayIndex = null; // 이전의 end_day를 초기화
        }
      }
    });
  });

  // start_day와 end_day 사이의 범위에 'ing' 클래스 부여
  function markInProgressRange(startIndex, endIndex) {
    $('.calendar_range_item').each(function(itemIndex) {
      var calendarRangeItem = $(this);

      // 각 td 요소 순회
      calendarRangeItem.find('tbody td').each(function() {
        var td = $(this);
        // var tdButton = td.find('button.day_default:not([disabled])');
        var tdButton = td.find('button.day_default');
        if (tdButton.length > 0) {
          var tdIndex = td.index();
          var trIndex = td.closest('tr').index();
          var finalIndex = (itemIndex + 1) * 100 + (trIndex + 1) * 10 + (tdIndex + 1); // 각 날짜의 인덱스 계산

          // 선택된 범위 내의 버튼에 'ing' 클래스 부여
          if (finalIndex > startIndex && finalIndex < endIndex) {
            tdButton.addClass('between');
          }
        }
      });
    });
  }
});










</script>



{{/ layout/default }}